<!DOCTYPE html>
<html lang="zh-CN">
    <script type="text/javascript"> if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) { window.location.href = "m.html"; } </script>
<head> 
    <meta charset="UTF-8" /> 
    <!--<meta http-equiv="refresh" content="0;url=https://xiaoniuss.fun">--> 
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" /> 
    <meta http-equiv="Cache-Control" content="no-siteapp" /> 
    <meta name="apple-mobile-web-app-capable" content="yes" /> 
    <meta name="apple-touch-fullscreen" content="yes" /> 
    <meta name="apple-mobile-web-app-status-bar-style" content="black" /> 
    <meta name="full-screen" content="yes" />
    <!--UC强制全屏--> 
    <meta name="browsermode" content="application" />
    <!--UC应用模式--> 
    <meta name="x5-fullscreen" content="true" />
    <!--QQ强制全屏--> 
    <meta name="x5-page-mode" content="app" />
    <!--QQ应用模式--> 
    <title>小牛搜索- XiaoNiuss.Top</title> 
    <meta name="keywords" content="信仰圣光.一款业余的导航网站">
    <meta name="description" content="可能是最简洁的搜索导航，给你简单舒爽的搜索体验。">
    <link rel="shortcut icon" href="https://img.alicdn.com/imgextra/i3/2327995847/O1CN01fhXl2q1t3yYaZYRnO_!!2327995847.png" type="image/png" /> 
    <link rel="stylesheet" href="css/a1.css" />  
    <link rel="stylesheet" href="css/settings.css" />
    <link rel="stylesheet" href="js/dhl/css/ai.css">
    <!-- 调整脚本加载顺序：先加载核心工具类 -->
    <script src="js/a2jquery1.min.js"></script>
    <script src="js/navigation-utils.js"></script>
    <script src="js/search-utils.js"></script>
<!-- 在index.html的<head>标签内添加以下样式 -->
<style>
    /* 顶部导航栏基础样式（日间模式） */
    .mod-header {
        background-color: rgba(180,180,180,0.8);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
    }
    
    /* 夜间模式下的顶部导航栏样式 */
    .dark-mode .mod-header {
        background-color: rgba(30, 31, 33, 0.8);
    }
    
    .dark-mode .mod-header-nav .top-cat a {
        color: #ddd;
    }
    
    .dark-mode .mod-header-nav .top-cat a:hover {
        color: #fff;
    }
    
    .dark-mode .mod-header-user .try,
    .dark-mode .mod-header-user .console {
        color: #000;
    }
    
    .dark-mode .mod-header-user .try:hover,
    .dark-mode .mod-header-user .console:hover {
        color: #fff;
    }
    
    .dark-mode .cat-tit {
        color: #ddd;
    }
    
    .dark-mode .cat-item a {
        color: #bbb;
    }
    
    .dark-mode .cat-item a:hover {
        color: #fff;
    }
    
    .dark-mode .cat-tag {
        background-color: rgba(255, 255, 255, 0.1);
        color: #bbb;
    }
    
    .dark-mode .mod-header-nav .slider {
        background-color: #61a0ff;
    }
</style>
</head> 
<body>
<div id="button-container">
    <div id="menu" class="edge-button top-button">
        <span class="button-text">导航</span>
    </div>
    <div id="settings-button" class="edge-button bottom-button">
        <span class="button-text">设置</span>
    </div>
</div>
    <div class="list closed"> 
        <ul>
            <!-- 导航内容将通过JS动态生成 -->
        </ul> 
    </div> 

<!-- 从dhl.html移动过来的顶部导航容器 -->
<div class="mod-header">
  <div class="cat">
    <div class="cat-box" data-cat="engine">
      <div class="layout">
        <div class="cat-group">
          <h3 class="cat-tit"><div class="cat-ico"><i class="ico-lan"></i></div>小游戏</h3>
          <ul class="cat-list">
            <li class="cat-item">
              <div class="cat-item-main">
                <span>模拟器</span>
              </div>
              <div class="cat-item-sub">
                <div class="cat-item-row">
                  <a href="https://fc.xiaoniuss.top/"target="_blank">FC模拟器<i class="cat-tag is-beta"></i></a>
                </div>
              </div>
            </li>
            <li class="cat-item">
              <div class="cat-item-main">
                <span>棋牌</span>
              </div>
              <div class="cat-item-sub">
                <div class="cat-item-row">
                  <a href="https://c.xiaoniuss.top/wzq/ "target="_blank">五子棋</a>
                  <a href="https://c.xiaoniuss.top/xq/"target="_blank">象棋<i class="cat-tag is-new"></i></a>
                  <a href="https://c.xiaoniuss.top/zhizhu/"target="_blank">蜘蛛纸牌<i class="cat-tag is-new"></i></a>
                </div>
              </div>
            </li>
            <li class="cat-item">
              <div class="cat-item-main">
                <a href="https://c.xiaoniuss.top/2048/"target="_blank">2048<i class="cat-tag is-hot"></i></a>
              </div>
            </li>
          </ul>
        </div>
        <div class="cat-group">
          <h3 class="cat-tit"><div class="cat-ico"><i class="ico-image"></i></div>小插件</h3>
          <ul class="cat-list">
            <li class="cat-item">
              <div class="cat-item-main">
                <span>开发者工具<i class="cat-tag is-hot"></i></span>
              </div>
              <div class="cat-item-sub">
                <div class="cat-item-row">
                  <a href="https://c.xiaoniuss.top/ys/"target="_blank">色值选择器</a>
                  <a href="https://c.xiaoniuss.top/bjq/"target="_blank">代码编辑器</a>
                </div>
              </div>
            </li>
          </ul>
        </div>
        <div class="cat-group">
          <h3 class="cat-tit"><div class="cat-ico"><i class="ico-voice"></i></div>导航产品</h3>
          <ul class="cat-list">
            <li class="cat-item">
              <div class="cat-item-main">
                <span>行业运营</span>
              </div>
              <div class="cat-item-sub">
                <div class="cat-item-row">
                  <a href="https://xydh.fun/guoxiaohan"target="_blank">运营官1号</a>
                  <a href="https://xydh.fun/dianshang"target="_blank">运营官<i class="cat-tag is-new"></i></a>
                  <a href="https://b.xiaoniuss.top"target="_blank">小牛书签<i class="cat-tag is-new"></i></a>
                </div>
              </div>
            </li>
            <li class="cat-item">
              <div class="cat-item-main">
                <a href="https://xiaoniuss.top"target="_blank">小牛搜索<i class="cat-tag is-new"></i></a>
              </div>
            </li>
            <li class="cat-item">
              <div class="cat-item-main">
                <span>小牛搜索简洁版(即将开放)</span>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="layout clearfix">
    <a href="" class="mod-header-logo"></a>

    <div class="mod-header-nav">
      <ul id="jmod-header-nav">
        <li id="nav-header-serv" class="top-cat hassub" data-cat="engine">
          <h2><a href="javascript:void(0);">旗下产品</a><i class="top-cat-arrow"></i></h2>
        </li><!---->
        <li id="nav-header-accelerator" class="top-cat"><h2><a href="https://xiaoniuss.top/"target="_blank">主站首页</a></h2></li>
        <li id="nav-header-info" class="top-cat"><h2><a href="https://y.xiaoniuss.top/"target="_blank">小游戏平台</a></h2></li>
        <li id="nav-header-hr" class="top-cat"><h2><a href="https://v.xiaoniuss.top/"target="_blank">vip视频解析</a></h2></li>
        <li id="nav-header-join" class="top-cat"><h2><a href="https://xydh.fun/guoxiaohan"target="_blank">运营官1号</a></h2></li>
        <li id="nav-header-doc" class="top-cat"><h2><a href="https://c.xiaoniuss.top/"target="_blank">小插件</a></h2></li>
        <li id="nav-header-doc" class="top-cat"><h2><a href="https://b.xiaoniuss.top/zhuye"target="_blank">网址发布页</a></h2></li>
      </ul>
      <i class="jmod-nav-slider slider hidden" style="transform: translateX(0px);"></i>
    </div>

    <div class="mod-header-user">
      <a href="https://support.qq.com/products/336749" target="_blank" class="try jmod-header-try">留言板</a>
      <a href="https://support.qq.com/products/336749" target="_blank" class="console jmod-header-console hidden">留言板</a>
    </div>
  </div>

</div>

<div class="banner jmod_banner">
  <div class="ban cur" style="background-color: rgba(30, 31, 33, 0.7); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); height: 62px;">
  </div>
</div>
<!-- 搜索框HTML -->
<div id="search" class="s-search">
    <div id="search-list" class="hide-type-list">
        <div class="s-type">
            <span class="type-text"></span>
            <div class="s-type-list animated fadeInUp">
                <!-- 由JS动态生成 -->
            </div>
        </div>
        <!-- 搜索组由JS动态生成 -->
    </div>
    <form action="https://www.baidu.com/s?wd=" method="get" target="_blank" id="super-search-fm">
        <input type="text" id="search-text" placeholder="输入关键字搜索" style="outline:0" />
        <button type="submit"><i class="iconfont icon-xdss"></i></button>
        <ul id="ul" class="ko"></ul>
    </form>
    <input type="checkbox" id="set-search-blank" class="bubble-3" autocomplete="off" style="display:none"/>
</div>

   </div>
  </div> 
<div class="footer">
  <div class="site-info">小牛搜索-XiaoNiuSs.Top</div>
  <!--<div class="copyright">©项目中大部分素材来自网络如有侵权可联系删除</div> -->
</div>
    <script src="js/a3sousuo.js"></script> 
    <script src="js/wallpaper-config.js" defer></script>
    <script src="js/settings.js" defer></script>
    <script src="js/notices.js" defer></script>
<script src="js/dhl/js/jquery.min.js"></script>
<script src="js/dhl/js/ai.js"></script>
<script>
  // 增强版数据加载逻辑：增加重试、缓存和备份机制
  (async function loadRemoteData() {
    const API_URL = 'js/shuju.js';
    const MAX_RETRIES = 2; // 最大重试次数
    let retryCount = 0;

    // 从本地缓存读取备份数据
    function getBackupData() {
      try {
        const navBackup = localStorage.getItem('navDataBackup');
        const searchBackup = localStorage.getItem('searchDataBackup');
        return {
          navigationData: navBackup ? JSON.parse(navBackup) : [],
          searchData: searchBackup ? JSON.parse(searchBackup) : []
        };
      } catch (e) {
        console.error('读取备份数据失败:', e);
        return { navigationData: [], searchData: [] };
      }
    }

    // 保存数据到本地缓存
    function saveBackupData(data) {
      try {
        if (data.navigationData) {
          localStorage.setItem('navDataBackup', JSON.stringify(data.navigationData));
        }
        if (data.searchData) {
          localStorage.setItem('searchDataBackup', JSON.stringify(data.searchData));
        }
      } catch (e) {
        console.error('保存备份数据失败:', e);
      }
    }

    // 核心加载函数（支持重试）
    async function fetchDataWithRetry() {
      try {
        // 使用AbortController设置超时
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 8000);
        
        const response = await fetch(API_URL, {
          signal: controller.signal,
          cache: 'no-store' // 禁用缓存，确保获取最新数据
        });
        
        clearTimeout(timeoutId);
        
        if (!response.ok) {
          throw new Error(`HTTP错误: ${response.status}`);
        }
        
        const dataText = await response.text();
        console.log('远程接口原始数据:', dataText);

        // 修复JSON提取逻辑（适配workers.js返回的"const appData = ..."格式）
        const jsonStr = dataText.replace(/^const\s+appData\s*=\s*/, '').replace(/;$/, '');
        const appData = JSON.parse(jsonStr);
        
        // 严格验证数据结构
        if (!Array.isArray(appData.navigationData)) {
          throw new Error('导航数据不是数组');
        }
        if (!Array.isArray(appData.searchData)) {
          throw new Error('搜索数据不是数组');
        }
        
        // 数据清洗与格式化
        const cleanData = {
          navigationData: appData.navigationData.map(cat => ({
            title: cat.title || '未命名分类',
            links: Array.isArray(cat.links) ? cat.links.map(link => ({
              name: link.name || '未命名链接',
              url: link.url || '#',
              rel: link.rel || 'nofollow',
              target: link.target || '_blank'
            })) : []
          })),
          searchData: appData.searchData.map(cat => ({
            id: cat.id || `group-${Date.now()}`,
            title: cat.title || '未命名搜索分类',
            options: Array.isArray(cat.options) ? cat.options.map(opt => ({
              id: opt.id || `opt-${Date.now()}`,
              value: opt.value || '#',
              placeholder: opt.placeholder || '请输入搜索内容',
              name: opt.name || '未命名搜索',
              checked: opt.checked || false
            })) : []
          }))
        };
        
        // 保存备份
        saveBackupData(cleanData);
        return cleanData;
        
      } catch (error) {
        // 重试逻辑
        if (retryCount < MAX_RETRIES) {
          retryCount++;
          console.log(`数据加载失败，正在重试（${retryCount}/${MAX_RETRIES}）:`, error);
          return fetchDataWithRetry();
        }
        throw error; // 达到最大重试次数，抛出错误
      }
    }

    // 执行加载流程
    try {
      // 先尝试从远程加载
      const data = await fetchDataWithRetry();
      
      // 更新全局数据
      window.navigationData = data.navigationData;
      window.searchData = data.searchData;
      
      // 触发UI更新
      if (window.NavigationUtils) {
        NavigationUtils.updateNavigation(window.navigationData);
      }
      if (window.SearchUtils) {
        SearchUtils.renderSearchOptions();
        SearchUtils.setupEventListeners();
      }
      
    } catch (error) {
      console.error('所有加载尝试失败，使用备份数据:', error);
      
      // 尝试使用备份数据
      const backupData = getBackupData();
      window.navigationData = backupData.navigationData;
      window.searchData = backupData.searchData;
      
      // 触发UI更新
      if (window.NavigationUtils) {
        NavigationUtils.updateNavigation(window.navigationData);
      }
      if (window.SearchUtils) {
        SearchUtils.renderSearchOptions();
        SearchUtils.setupEventListeners();
      }
      
      // 显示用户提示
      const alertEl = document.createElement('div');
      alertEl.style = 'position:fixed;top:20px;left:50%;transform:translateX(-50%);padding:10px 20px;background:#ff4444;color:white;border-radius:4px;z-index:9999';
      alertEl.textContent = '数据加载失败，已使用缓存数据';
      document.body.appendChild(alertEl);
      setTimeout(() => alertEl.remove(), 3000);
    }
  })();

  // 搜索表单提交验证
  document.getElementById('super-search-fm').addEventListener('submit', function(e) {
    // 检查是否有可用的搜索数据
    if (!window.searchData || window.searchData.length === 0) {
      e.preventDefault();
      alert('搜索数据未加载完成，请稍候再试');
      return false;
    }
    
    // 检查输入内容
    const searchText = document.getElementById('search-text').value.trim();
    if (!searchText) {
      e.preventDefault();
      document.getElementById('search-text').focus();
      return false;
    }
    
    // 动态修改表单提交地址
    const activeOption = document.querySelector('input[name="search-type"]:checked');
    if (activeOption) {
      e.preventDefault();
      const url = activeOption.value + encodeURIComponent(searchText);
      window.open(url, '_blank');
      return false;
    }
    
    return true;
  });
</script>

<!-- 外部脚本：异步加载（不阻塞，加载完成后立即执行） -->

